base: ../globals.yaml

layers:
  - name: astoria2004
    title: City of Astoria 2004
    md:
      attribution:
        title: City of Astoria GIS
        url: https://gis.astoria.or.us/
    layers:
      - name: astoria2004
        title: Astoria 2004 6"
        sources: [astoria2004_cache]

  - name: astoria2010
    title: City of Astoria 2010
    md:
      attribution:
        title: City of Astoria GIS
        url: https://gis.astoria.or.us/
    layers:
      - name: astoria2010
        title: Astoria 2010 6"
        sources: [astoria2010_cache]

  - name: astoria2015
    title: City of Astoria 2015
    md:
      attribution:
        title: City of Astoria GIS
        url: https://gis.astoria.or.us/
    layers:
      - name: astoria2015
        title: Astoria 2015 6"
        sources: [astoria2015_cache]


# I don't have any URL for this so I need to seed the cache directly from images, until then I'm leaving it out.
# My thinking is: TIFF images -> GDAL VRT mosaic -> tiles -> mapproxy seed or cdbtiles -> couchdb
#  - name: warrenton2011
#    title: City of Warrenton
#    layers:
#      - name: warrenton
#        title: Warrenton 2011 6"
#        sources: [warrenton2011_cache]

caches:
  astoria2015_cache:
    grids: [astoria]
    sources: [astoria2015_source]
    format: image/jpeg
    request_format: image/jpeg
    cache: 
      type: couchdb
      url: http://couchdb:5984
      db_name: astoria2015
      tile_metadata: 
        tile_col: '{{x}}'
        tile_row: '{{y}}'
        tile_level: '{{z}}'
        created_ts: '{{timestamp}}'
        created: '{{utc_iso}}'
        center: '{{wgs_tile_centroid}}'

  astoria2010_cache:
    grids: [astoria]
    sources: [astoria2010_source]
    format: image/jpeg
    request_format: image/jpeg
    cache: 
      type: couchdb
      url: http://couchdb:5984
      db_name: astoria2010
      tile_metadata: 
        tile_col: '{{x}}'
        tile_row: '{{y}}'
        tile_level: '{{z}}'
        created_ts: '{{timestamp}}'
        created: '{{utc_iso}}'
        center: '{{wgs_tile_centroid}}'

  astoria2004_cache:
    grids: [astoria]
    sources: [astoria2004_source]
    format: image/jpeg
    request_format: image/jpeg
    cache: 
      type: couchdb
      url: http://couchdb:5984
      db_name: astoria2004
      tile_metadata: 
        tile_col: '{{x}}'
        tile_row: '{{y}}'
        tile_level: '{{z}}'
        created_ts: '{{timestamp}}'
        created: '{{utc_iso}}'
        center: '{{wgs_tile_centroid}}'

  warrenton2011_cache:
    grids: [warrenton]
    sources: [warrenton2011_source]
    format: image/jpeg
    request_format: image/jpeg
    cache: 
      type: couchdb
      url: http://couchdb:5984
      db_name: warrenton2011
      tile_metadata: 
        tile_col: '{{x}}'
        tile_row: '{{y}}'
        tile_level: '{{z}}'
        created_ts: '{{timestamp}}'
        created: '{{utc_iso}}'
        center: '{{wgs_tile_centroid}}'
            
sources:
  astoria2015_source:
    type: wms
    req:
      url: https://gis.astoria.or.us/cgi-bin/mapserv.exe?VERSION=1.1.1&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fair_2015.map&SRS=EPSG%3A3857
      layers: air_2015
      transparent: true

  astoria2010_source:
    type: wms
    req:
      url: https://gis.astoria.or.us/cgi-bin/mapserv.exe?SERVICE=WMS&VERSION=1.1.1&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fastoria_aerial_hires_2010.map&SRS=EPSG%3A3857
      layers: aerials2010
      transparent: true
# https://gis.astoria.or.us/cgi-bin/mapserv.exe?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&FORMAT=image%2Fpng%3Bbits%3D8&TRANSPARENT=true&LAYERS=aerials2010&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fastoria_aerial_hires_2010.map&SRS=EPSG%3A3857&STYLES=&MAP_RESOLUTION=112.5&WIDTH=1333&HEIGHT=1026&BBOX=-13786760.476540796%2C5809172.109307839%2C-13784213.212573193%2C5811132.719083354

  astoria2004_source:
    type: wms
    req:
      url: https://gis.astoria.or.us/cgi-bin/mapserv.exe?SERVICE=WMS&VERSION=1.1.1&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fastoria_aerial_hires_2004.map&SRS=EPSG%3A3857
      layers: aerials2004
      transparent: true
# https://gis.astoria.or.us/cgi-bin/mapserv.exe?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&FORMAT=image%2Fpng%3Bbits%3D8&TRANSPARENT=true&LAYERS=aerials2004&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fastoria_aerial_hires_2004.map&SRS=EPSG%3A3857&STYLES=&MAP_RESOLUTION=112.5&WIDTH=1333&HEIGHT=1026&BBOX=-13786760.476540796%2C5809172.109307839%2C-13784213.212573193%2C5811132.719083354

  warrenton2011_source:
    type: wms
    req:
      url: https://gis.astoria.or.us/cgi-bin/mapserv.exe?VERSION=1.1.1&MAP=%2Fms4w%2Fapps%2Fastoria31_Public%2Fhtdocs%2Fastoria31%2Fmaps%2F.%2Fair_2015.map&SRS=EPSG%3A3857
      layers: air_2015
      transparent: true
      
grids:
  astoria:
    base: GLOBAL_WEBMERCATOR
    bbox: [-123.87,46.16,-123.73,46.22] # City of Astoria
    bbox_srs: EPSG:4326
                                
  warrenton:
    base: GLOBAL_WEBMERCATOR
    bbox: [-123.87,46.16,-123.73,46.22] # City of Astoria
    bbox_srs: EPSG:4326
